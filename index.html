<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dodge the Bullets Game</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #e0f7fa;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: 'Arial', sans-serif;
        }

        #gameCanvas {
            width: 1200px;
            height: 800px;
            background-color: #fff;
            border: 2px solid #333;
            position: relative;
            overflow: hidden;
        }

        .man {
            width: 20px;
            height: 20px;
            background-color: #4CAF50;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            border-radius: 10px;
            transition: transform 0.3s; /* Animation effect */
        }

        .bullet {
            position: absolute;
            background-color: #FF5722;
            border-radius: 5px;
        }

        .heal {
            position: absolute;
            background-color: #65EBFF;
            border-radius: 5px;
        }

        .shield {
            position: absolute;
            border: 2px solid #FFD700;
            border-radius: 50%;
            pointer-events: none;
        }

        #hp {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 20px;
            font-weight: bold;
        }

        #score {
            position: absolute;
            top: 10px;
            left: 150px;
            font-size: 20px;
            font-weight: bold;
        }

        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 30px;
            font-weight: bold;
            display: none;
        }

        .cooldown {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 20px;
            font-weight: bold;
        }
    </style>
</head>

<body>

    <div>
        <div>
            <h1> Dodge Bullets Game</h1>
        </div>
        <div id="gameCanvas">
            <div class="man" id="man"></div>
            <div id="hp">HP: 100</div>
            <div id="score">Score: 0</div>
            <div id="gameOver">Game Over! Press R to Restart</div>
            <div class="cooldown" id="cooldownDisplay">Cooldowns: Q: 0s, W: 0s, E: 0s</div>
        </div>
    </div>

    <script>
        const man = document.getElementById('man');
        const gameCanvas = document.getElementById('gameCanvas');
        const hpDisplay = document.getElementById('hp');
        const scoreDisplay = document.getElementById('score');
        const gameOverDisplay = document.getElementById('gameOver');
        const cooldownDisplay = document.getElementById('cooldownDisplay');
        const Bullet = "bullet";
        const Heal = "heal";
        let timeSpawnBullets;
        let spawnBulletsOneTime;
        const baseManMove = 20;
        const speedBoost = 40; // Increased speed for Skill Q
        const shieldDuration = 5000; // Shield lasts for 5 seconds
        const healAmount = 20; // Amount healed
        let hp = 100;
        let score = 0;
        let gameOver = false;
        let shieldActive = false;

        // Cooldown times in seconds
        const cooldownTimes = {
            Q: 25,
            W: 10,
            E: 40
        };

        // Remaining cooldowns
        const remainingCooldowns = {
            Q: 0,
            W: 0,
            E: 0
        };

        document.addEventListener('keydown', (event) => {
            if (gameOver && event.key === 'r') {
                location.reload(); // Reload the page to restart
            }
            if (!gameOver) {
                switch (event.key) {
                    case 'ArrowLeft':
                        moveMan(-baseManMove, 0);
                        break;
                    case 'ArrowRight':
                        moveMan(baseManMove, 0);
                        break;
                    case 'ArrowUp':
                        moveMan(0, -baseManMove);
                        break;
                    case 'ArrowDown':
                        moveMan(0, baseManMove);
                        break;
                    case 'q': // Activate Skill Q
                        activateSkillQ();
                        break;
                    case 'w': // Activate Skill W
                        activateSkillW();
                        break;
                    case 'e': // Activate Skill E
                        activateSkillE();
                        break;
                }
            }
        });

        function moveMan(x, y) {
            const manPositionX = man.offsetLeft + x;
            const manPositionY = man.offsetTop + y;

            // Check boundaries
            if (manPositionX >= 0 && manPositionX <= gameCanvas.clientWidth - man.clientWidth) {
                man.style.left = manPositionX + 'px';
            }
            if (manPositionY >= 0 && manPositionY <= gameCanvas.clientHeight - man.clientHeight) {
                man.style.top = manPositionY + 'px';
            }
        }

        function activateSkillQ() {
            if (remainingCooldowns.Q === 0) {
                shieldActive = true;
                startCooldown('Q');

                const shield = document.createElement('div');
                shield.classList.add('shield');
                shield.style.width = '50px';
                shield.style.height = '50px';
                shield.style.left = (man.offsetLeft - 24) + 'px';
                shield.style.top = (man.offsetTop - 25) + 'px';
                gameCanvas.appendChild(shield);

                // Move the shield with the man
                const moveShield = setInterval(() => {
                    if (shieldActive) {
                        shield.style.left = (man.offsetLeft - 25) + 'px';
                        shield.style.top = (man.offsetTop - 25) + 'px';
                    }
                }, 20);

                // Remove the shield after the duration
                setTimeout(() => {
                    shieldActive = false;
                    clearInterval(moveShield);
                    gameCanvas.removeChild(shield);
                }, shieldDuration);
            }
        }

        function activateSkillW() {
            if (remainingCooldowns.W === 0) {
                moveFaster();
                startCooldown('W');
            }
        }

        function activateSkillE() {
            if (remainingCooldowns.E === 0) {
                heal(healAmount);
                startCooldown('E');
                animateHeal(); // Trigger healing animation
            }
        }

        function animateHeal() {
            man.style.transform = 'scale(2.5)'; // Scale up
            setTimeout(() => {
                man.style.transform = 'scale(1)'; // Scale back down
            }, 300); // Duration of the scale effect
        }

        function startCooldown(skill) {
            remainingCooldowns[skill] = cooldownTimes[skill];
            updateCooldownDisplay();

            const cooldownInterval = setInterval(() => {
                remainingCooldowns[skill]--;
                updateCooldownDisplay();

                if (remainingCooldowns[skill] <= 0) {
                    clearInterval(cooldownInterval);
                    remainingCooldowns[skill] = 0;
                    updateCooldownDisplay();
                }
            }, 1000);
        }

        function updateCooldownDisplay() {
            cooldownDisplay.textContent = `Cooldowns: Q: ${remainingCooldowns.Q}s, W: ${remainingCooldowns.W}s, E: ${remainingCooldowns.E}s`;
        }

        function activateShield() {
            if (!shieldActive) {
                shieldActive = true;
                const shield = document.createElement('div');
                shield.classList.add('shield');
                shield.style.width = '50px';
                shield.style.height = '50px';
                shield.style.left = (man.offsetLeft - 15) + 'px';
                shield.style.top = (man.offsetTop - 15) + 'px';
                gameCanvas.appendChild(shield);

                setTimeout(() => {
                    shieldActive = false;
                    gameCanvas.removeChild(shield);
                }, 3000); // Shield lasts for 3 seconds
            }
        }


        function moveFaster() {
            baseManMove += 20
                // setTimeout(() => {
                //     baseManMove -= 20
                // }, 10000); 
        }


        function heal(amount) {
            hp += amount;
            if (hp > 100) hp = 100; // Max HP cap
            hpDisplay.textContent = 'HP: ' + hp;
        }

        function spawnBullets() {
            let spawn = spawnBulletsOneTime;
            const difficulty = Math.floor(score / 30);
            if (difficulty > 0) {
                spawn += difficulty;
            }

            const directions = ['top', 'left', 'right', 'bottom'];
            for (let i = 0; i < spawn; i++) {
                createObject(directions[Math.floor(Math.random() * directions.length)], Bullet);
            }

            createObject(directions[Math.floor(Math.random() * directions.length)], Heal);
        }

        function createObject(direction, objectName) {
            const object = document.createElement('div');
            object.classList.add(objectName);

            const bulletWidth = Math.random() * 20 + 3;
            object.style.width = direction === 'left' || direction === 'right' ? '10px' : bulletWidth + 'px';
            object.style.height = direction === 'left' || direction === 'right' ? bulletWidth + 'px' : '10px';

            if (direction === 'top') {
                object.style.left = Math.random() * (gameCanvas.clientWidth - bulletWidth) + 'px';
                object.style.top = '0px';
            } else if (direction === 'bottom') {
                object.style.left = Math.random() * (gameCanvas.clientWidth - bulletWidth) + 'px';
                object.style.top = gameCanvas.clientHeight - object.offsetHeight + 'px';
            } else if (direction === 'left') {
                object.style.left = '0px';
                object.style.top = Math.random() * (gameCanvas.clientHeight - bulletWidth) + 'px';
            } else if (direction === 'right') {
                object.style.left = (gameCanvas.clientWidth - bulletWidth) + 'px';
                object.style.top = Math.random() * (gameCanvas.clientHeight - bulletWidth) + 'px';
            }

            gameCanvas.appendChild(object);

            const interval = setInterval(() => {
                let objectPosition;

                if (direction === 'top') {
                    objectPosition = parseInt(object.style.top) + 5; // Move down
                    object.style.top = objectPosition + 'px';
                } else if (direction === 'bottom') {
                    objectPosition = parseInt(object.style.top) - 5; // Move up
                    object.style.top = objectPosition + 'px';
                } else if (direction === 'left') {
                    objectPosition = parseInt(object.style.left) + 5; // Move right
                    object.style.left = objectPosition + 'px';
                } else if (direction === 'right') {
                    objectPosition = parseInt(object.style.left) - 5; // Move left
                    object.style.left = objectPosition + 'px';
                }

                // Check for collision with the man
                const manRect = man.getBoundingClientRect();
                const bulletRect = object.getBoundingClientRect();

                if (
                    bulletRect.bottom >= manRect.top &&
                    bulletRect.top <= manRect.bottom &&
                    bulletRect.right >= manRect.left &&
                    bulletRect.left <= manRect.right
                ) {
                    if (hp > 0) {
                        if (objectName === Bullet) {
                            if (!shieldActive) {
                                hp -= bulletWidth;
                            }
                        } else {
                            hp += bulletWidth;
                        }

                        hp = Math.floor(hp);
                        if (hp < 0) {
                            hp = 0;
                        }
                        hpDisplay.textContent = 'HP: ' + hp;
                    }
                    clearInterval(interval);
                    gameCanvas.removeChild(object);
                    if (hp <= 0) {
                        endGame();
                    }
                }

                // Remove object if it goes off the screen
                if ((direction === 'top' && objectPosition > gameCanvas.clientHeight) ||
                    (direction === 'bottom' && objectPosition < -10) ||
                    (direction === 'left' && objectPosition > gameCanvas.clientWidth) ||
                    (direction === 'right' && objectPosition < -10)) {
                    clearInterval(interval);
                    gameCanvas.removeChild(object);
                }
            }, 20);
        }

        function endGame() {
            gameOver = true;
            clearInterval(bulletInterval);
            clearInterval(scoreInterval);
            gameOverDisplay.style.display = 'block';
        }

        function selectDifficulty() {
            return new Promise((resolve) => {
                const selectedDifficulty = prompt("Welcome to the Dodge Bullets Game! Please select your difficulty:\n1. Easy\n2. Normal\n3. Hard\n4. So Hard");
                switch (selectedDifficulty) {
                    case '1':
                        timeSpawnBullets = 800;
                        spawnBulletsOneTime = 1;
                        break;
                    case '2':
                        timeSpawnBullets = 600;
                        spawnBulletsOneTime = 2;
                        break;
                    case '3':
                        timeSpawnBullets = 500;
                        spawnBulletsOneTime = 3;
                        break;
                    case '4':
                        timeSpawnBullets = 300;
                        spawnBulletsOneTime = 4;
                        break;
                    default:
                        timeSpawnBullets = 600;
                        spawnBulletsOneTime = 2;
                }
                resolve();
            });
        }

        // Function to update the score
        function updateScore() {
            score += 1; // Increment score by 1
            scoreDisplay.textContent = 'Score: ' + score; // Update the displayed score
        }

        async function init() {
            await selectDifficulty();
            scoreInterval = setInterval(updateScore, 1000);
            bulletInterval = setInterval(spawnBullets, timeSpawnBullets); // Create bullets based on selected difficulty
        }

        window.onload = init; // Start the game when the page loads
    </script>
</body>

</html>